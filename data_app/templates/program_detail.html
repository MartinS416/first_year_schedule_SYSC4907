{% extends "base.html" %} {% load static %} {% block title %}{{
program.program_name }}{% endblock %} {% block page_title %}{{
program.program_name }} Engineering{% endblock %} {% block topbar_actions %}
<a href="{% url 'dashboard' %}" class="btn btn-ghost btn-sm">
    <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Back to Dashboard
</a>
{% endblock %} {% block content %}

<!-- Program Hero -->
<div class="program-hero">
    <div class="program-hero-top">
        <div>
            <h2 class="program-hero-title">
                {{ program.program_name }} Engineering
            </h2>
            <p class="text-sm text-muted" style="margin-top: 4px">
                First-year schedule overview and block assignments
            </p>
        </div>
        <div style="display: flex; gap: var(--space-3)">
            <a href="{% url 'generate' %}" class="btn btn-outline btn-sm">
                <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                </svg>
                Regenerate
            </a>
        </div>
    </div>

    <div class="program-hero-stats">
        <div class="program-hero-stat">
            <div class="program-hero-stat-value">
                {{ program.enrolled|default:"0" }}
            </div>
            <div class="program-hero-stat-label">Students Enrolled</div>
        </div>
        <div class="program-hero-stat">
            <div class="program-hero-stat-value">{{ blocks_data|length }}</div>
            <div class="program-hero-stat-label">Blocks</div>
        </div>
        <div class="program-hero-stat">
            <div class="program-hero-stat-value">{{ fall_reqs|length }}</div>
            <div class="program-hero-stat-label">Fall Courses</div>
        </div>
        <div class="program-hero-stat">
            <div class="program-hero-stat-value">{{ winter_reqs|length }}</div>
            <div class="program-hero-stat-label">Winter Courses</div>
        </div>
    </div>
</div>

<!-- Required Courses Summary -->
<div class="card mb-6">
    <div class="card-header">
        <div>
            <h3 class="card-header-title">Required Courses</h3>
            <p class="card-header-subtitle">
                Courses required for this program by term
            </p>
        </div>
    </div>
    <div
        class="card-body"
        style="display: flex; gap: var(--space-8); flex-wrap: wrap"
    >
        <div style="flex: 1; min-width: 240px">
            <h4 class="text-sm text-bold mb-2" style="color: var(--gray-700)">
                <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    style="
                        display: inline-block;
                        vertical-align: middle;
                        margin-right: 4px;
                        color: var(--warning-500);
                    "
                >
                    <path
                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
                    ></path>
                </svg>
                Fall Term
            </h4>
            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2)">
                {% for code in fall_reqs %}
                <span class="pill pill-primary">{{ code }}</span>
                {% empty %}
                <span class="text-xs text-muted">No requirements defined</span>
                {% endfor %}
            </div>
        </div>
        <div style="flex: 1; min-width: 240px">
            <h4 class="text-sm text-bold mb-2" style="color: var(--gray-700)">
                <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    style="
                        display: inline-block;
                        vertical-align: middle;
                        margin-right: 4px;
                        color: var(--info-500);
                    "
                >
                    <path
                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
                    ></path>
                </svg>
                Winter Term
            </h4>
            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2)">
                {% for code in winter_reqs %}
                <span class="pill pill-primary">{{ code }}</span>
                {% empty %}
                <span class="text-xs text-muted">No requirements defined</span>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Term Filter Tabs -->
{% if terms_available %}
<div class="term-tabs" id="term-tabs">
    <button class="term-tab active" data-term="all">All Terms</button>
    {% for term_name in terms_available %}
    <button class="term-tab" data-term="{{ term_name }}">
        {{ term_name|title }} Term
    </button>
    {% endfor %}
</div>
{% endif %}

<!-- Blocks -->
{% if blocks_data %}
<div class="blocks-container" id="blocks-container">
    {% for block_info in blocks_data %} {% for term_data in block_info.terms %}
    <div class="block-card" data-term="{{ term_data.term.term_name }}">
        <div
            class="block-card-header"
            data-toggle="block-content-{{ block_info.block.id }}-{{ term_data.term.id }}"
            aria-expanded="false"
        >
            <div class="block-card-header-left">
                <span class="block-label"
                    >{{ block_info.block.block_name }}</span
                >
                <span class="block-size">
                    <svg
                        width="12"
                        height="12"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="
                            display: inline-block;
                            vertical-align: middle;
                            margin-right: 2px;
                        "
                    >
                        <path
                            d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"
                        ></path>
                        <circle cx="9" cy="7" r="4"></circle>
                    </svg>
                    {{ block_info.block.size|default:"?" }} students
                </span>
                <span class="pill pill-neutral" style="font-size: 0.6875rem"
                    >{{ term_data.term.term_name|title }}</span
                >

                {% if term_data.missing %}
                <span class="pill pill-danger" style="font-size: 0.6875rem">
                    <svg
                        width="10"
                        height="10"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="display: inline-block; vertical-align: middle"
                    >
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    {{ term_data.missing|length }} missing
                </span>
                {% endif %}
            </div>

            <div
                style="display: flex; align-items: center; gap: var(--space-3)"
            >
                {% if block_info.block.ranking %}
                <span
                    class="block-ranking ranking-{{ block_info.ranking_class }}"
                >
                    {{ block_info.block.ranking }}/100
                </span>
                {% endif %}

                <svg
                    class="chevron-icon"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </div>
        </div>

        <div
            class="block-card-content"
            id="block-content-{{ block_info.block.id }}-{{ term_data.term.id }}"
        >
            <!-- Visual Timetable -->
            <div class="timetable-wrapper" data-timetable="true">
                <script type="application/json" class="tt-data">
                    {{ term_data.courses_json|safe }}
                </script>
            </div>

            <!-- View Toggle -->
            <div
                style="
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: var(--space-3) var(--space-6);
                    border-top: 1px solid var(--gray-100);
                    border-bottom: 1px solid var(--gray-100);
                    background: var(--gray-50);
                "
            >
                <span class="text-xs text-muted" style="font-weight: 500">
                    {{ term_data.courses_table|length }} course section{{
                    term_data.courses_table|length|pluralize }}
                </span>
                <button
                    class="btn btn-ghost btn-sm toggle-table-btn"
                    data-target="course-table-{{ block_info.block.id }}-{{ term_data.term.id }}"
                >
                    <svg
                        width="14"
                        height="14"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect
                            x="3"
                            y="3"
                            width="18"
                            height="18"
                            rx="2"
                            ry="2"
                        ></rect>
                        <line x1="3" y1="9" x2="21" y2="9"></line>
                        <line x1="3" y1="15" x2="21" y2="15"></line>
                        <line x1="9" y1="3" x2="9" y2="21"></line>
                    </svg>
                    Toggle Table View
                </button>
            </div>

            <!-- Course Table (hidden by default) -->
            <div
                class="course-table-wrapper"
                id="course-table-{{ block_info.block.id }}-{{ term_data.term.id }}"
                style="display: none"
            >
                {% if term_data.courses_table %}
                <table class="course-table">
                    <thead>
                        <tr>
                            <th>Course Code</th>
                            <th>Section</th>
                            <th>Type</th>
                            <th>Days</th>
                            <th>Time</th>
                            <th>Enrollment</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in term_data.courses_table %}
                        <tr>
                            <td class="course-code-cell">{{ c.code }}</td>
                            <td>{{ c.section }}</td>
                            <td>
                                <span
                                    class="course-type-badge type-{{ c.type|lower }}"
                                    >{{ c.type }}</span
                                >
                            </td>
                            <td>{{ c.days }}</td>
                            <td>
                                {% if c.start_time %} {{ c.start_time }} – {{
                                c.end_time }} {% else %}
                                <span class="text-muted">—</span>
                                {% endif %}
                            </td>
                            <td>
                                <div
                                    class="enrollment-bar enrollment-{{ c.enrollment_status }}"
                                >
                                    <div class="enrollment-bar-track">
                                        <div
                                            class="enrollment-bar-fill"
                                            style="width: {{ c.enrollment_pct }}%;"
                                        ></div>
                                    </div>
                                    <span class="enrollment-text"
                                        >{{ c.enrolled }}/{{ c.capacity }}</span
                                    >
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-sm text-muted" style="padding: var(--space-4)">
                    No courses assigned to this term.
                </p>
                {% endif %}
            </div>

            <!-- Missing Courses Warning -->
            {% if term_data.missing %}
            <div class="missing-courses">
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                    ></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span>
                    <strong>Missing courses:</strong>
                    {% for code in term_data.missing %}
                    <span
                        class="pill pill-danger"
                        style="margin-left: 4px; font-size: 0.6875rem"
                        >{{ code }}</span
                    >
                    {% endfor %}
                </span>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %} {% endfor %}
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <div class="empty-state-icon">
            <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </div>
        <h3 class="empty-state-title">No Schedule Generated</h3>
        <p class="empty-state-text">
            This program doesn't have any blocks or schedules yet. Generate a
            schedule to see block assignments and timetables.
        </p>
        <a href="{% url 'generate' %}" class="btn btn-primary">
            <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Generate Schedule
        </a>
    </div>
</div>
{% endif %} {% endblock %} {% block extra_scripts %}
<script>
    (function () {
        // Toggle table view buttons
        document.querySelectorAll(".toggle-table-btn").forEach(function (btn) {
            btn.addEventListener("click", function (e) {
                e.stopPropagation();
                var targetId = btn.getAttribute("data-target");
                var tableWrapper = document.getElementById(targetId);
                if (tableWrapper) {
                    if (tableWrapper.style.display === "none") {
                        tableWrapper.style.display = "block";
                        btn.classList.add("active");
                    } else {
                        tableWrapper.style.display = "none";
                        btn.classList.remove("active");
                    }
                }
            });
        });
    })();
</script>
{% endblock %}
